<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dzul's Live Currency Converter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .converter-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 800px;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(to right, #4f46e5, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 300;
        }

        .content {
            padding: 40px;
        }

        .input-section {
            background: #f8fafc;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .input-label {
            font-weight: 600;
            color: #475569;
            font-size: 14px;
            min-width: 140px;
        }

        .currency-select, .amount-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .currency-select:focus, .amount-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .currency-select {
            background: white;
            cursor: pointer;
        }

        .amount-input {
            background: white;
        }

        .results-section {
            display: grid;
            gap: 15px;
        }

        .currency-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .currency-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .currency-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .currency-flag {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #4f46e5;
            font-size: 20px;
        }

        .currency-details h3 {
            font-size: 16px;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .currency-details p {
            font-size: 14px;
            color: #64748b;
        }

        .conversion-result {
            text-align: right;
        }

        .conversion-amount {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 6px;
        }

        .percentage-change {
            font-size: 14px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .positive {
            background: #dcfce7;
            color: #166534;
        }

        .negative {
            background: #fee2e2;
            color: #991b1b;
        }

        .neutral {
            background: #e0f2fe;
            color: #0369a1;
        }

        .arrow {
            font-size: 16px;
            font-weight: bold;
        }

        .arrow.up {
            color: #16a34a;
        }

        .arrow.down {
            color: #dc2626;
        }

        .arrow.neutral {
            color: #0ea5e9;
        }

        .footer {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            padding: 25px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #64748b;
        }

        .legend-icon {
            font-size: 14px;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-primary:hover {
            background: #4338ca;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .timestamp {
            font-size: 13px;
            color: #64748b;
            text-align: center;
            margin-top: 20px;
        }

        .mode-indicator {
            font-size: 12px;
            color: #64748b;
            text-align: center;
            margin-top: 5px;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .content {
                padding: 25px;
            }
            
            .input-group {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            
            .input-label {
                min-width: auto;
            }
            
            .currency-card {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .conversion-result {
                text-align: center;
            }
            
            .footer {
                flex-direction: column;
                text-align: center;
            }
            
            .legend {
                justify-content: center;
            }
            
            .controls {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="converter-container">
        <div class="header">
            <h1>Dzul's Live Currency Converter</h1>
            <div class="subtitle">Real-time exchange rates for your 5 selected currencies</div>
        </div>

        <div class="content">
            <div class="input-section">
                <div class="input-group">
                    <label class="input-label">Convert From:</label>
                    <select class="currency-select" id="fromCurrency">
                        <option value="SGD">ðŸ‡¸ðŸ‡¬ Singapore Dollar (SGD)</option>
                        <option value="MYR">ðŸ‡²ðŸ‡¾ Malaysian Ringgit (MYR)</option>
                        <option value="IDR">ðŸ‡®ðŸ‡© Indonesian Rupiah (IDR)</option>
                        <option value="SAR">ðŸ‡¸ðŸ‡¦ Saudi Riyal (SAR)</option>
                        <option value="USD">ðŸ‡ºðŸ‡¸ US Dollar (USD)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Amount to Convert:</label>
                    <input 
                        type="number" 
                        class="amount-input" 
                        id="amount" 
                        value="100" 
                        min="0" 
                        step="0.01"
                        placeholder="Enter amount"
                    >
                </div>
            </div>

            <div class="results-section" id="results">
                <div class="loading">Loading live exchange rates...</div>
            </div>

            <div class="timestamp">
                Last updated: <span id="updateTime">--:--:-- --</span>
                <div id="modeIndicator" class="mode-indicator">ðŸ”µ DEMO MODE - Using simulated rates (No API calls)</div>
                <small>Live rates from ExchangeRate-API â€¢ Updates every 30 seconds</small>
            </div>
        </div>

        <div class="footer">
            <div class="legend">
                <div class="legend-item">
                    <span class="legend-icon" style="color: #16a34a;">â†‘</span>
                    <span>Currency getting STRONGER</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon" style="color: #dc2626;">â†“</span>
                    <span>Currency getting WEAKER</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon" style="color: #0ea5e9;">â†’</span>
                    <span>No change detected</span>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-warning" id="modeBtn">
                    ðŸ”„ Switch to Real Rates
                </button>
                <button class="btn btn-secondary" id="resetBtn">
                    Reset to SGD 100
                </button>
                <button class="btn btn-primary" id="refreshBtn">
                    â†» Refresh Live Rates
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== CONFIGURATION ==========
        let demoMode = true; // TRUE = Demo mode (no API calls), FALSE = Real API mode
        // ========== END CONFIGURATION ==========

        // Your 5 currencies
        const currencies = ['SGD', 'MYR', 'IDR', 'SAR', 'USD'];
        
        const currencyData = {
            SGD: { name: "Singapore Dollar", flag: "ðŸ‡¸ðŸ‡¬", symbol: "S$" },
            MYR: { name: "Malaysian Ringgit", flag: "ðŸ‡²ðŸ‡¾", symbol: "RM" },
            IDR: { name: "Indonesian Rupiah", flag: "ðŸ‡®ðŸ‡©", symbol: "Rp" },
            SAR: { name: "Saudi Riyal", flag: "ðŸ‡¸ðŸ‡¦", symbol: "ï·¼" },
            USD: { name: "US Dollar", flag: "ðŸ‡ºðŸ‡¸", symbol: "$" }
        };

        // Store rates
        let currentRates = {};
        let rateCache = {};
        let cacheDuration = 30 * 60 * 1000; // Cache for 30 minutes

        function formatCurrency(amount, currencyCode) {
            switch(currencyCode) {
                case 'IDR':
                    return `Rp ${Math.round(amount).toLocaleString('id-ID')}`;
                case 'MYR':
                    return `RM ${amount.toFixed(2)}`;
                case 'SAR':
                    return `ï·¼ ${amount.toFixed(2)}`;
                case 'USD':
                    return `$${amount.toFixed(2)}`;
                case 'SGD':
                default:
                    return `S$${amount.toFixed(2)}`;
            }
        }

        function calculatePercentageChange(current, previous) {
            if (!previous || previous === 0) return 0;
            return ((current - previous) / previous) * 100;
        }

        function getArrowAndClass(percentage) {
            if (percentage > 0.01) {
                return { arrow: 'â†‘', arrowClass: 'up', changeClass: 'positive' };
            } else if (percentage < -0.01) {
                return { arrow: 'â†“', arrowClass: 'down', changeClass: 'negative' };
            } else {
                return { arrow: 'â†’', arrowClass: 'neutral', changeClass: 'neutral' };
            }
        }

        function formatPercentage(percentage) {
            const absPercentage = Math.abs(percentage);
            if (absPercentage < 0.01) return "0.00%";
            return `${percentage > 0 ? '+' : ''}${percentage.toFixed(2)}%`;
        }

        function generateDemoRate(baseRate) {
            const change = (Math.random() * 0.004) - 0.002;
            return baseRate * (1 + change);
        }

        function getDemoRates(baseCurrency) {
            const baseRates = {
                SGD: { MYR: 3.1807, IDR: 11286.57, SAR: 2.79, USD: 0.74, SGD: 1 },
                MYR: { SGD: 0.3145, IDR: 3560.25, SAR: 0.88, USD: 0.234, MYR: 1 },
                IDR: { SGD: 0.0000886, MYR: 0.000281, SAR: 0.000247, USD: 0.000066, IDR: 1 },
                SAR: { SGD: 0.358, MYR: 1.137, IDR: 4052.12, USD: 0.267, SAR: 1 },
                USD: { SGD: 1.351, MYR: 4.285, IDR: 15280.50, SAR: 3.75, USD: 1 }
            };
            
            const base = baseRates[baseCurrency] || baseRates.SGD;
            const newRates = {};
            
            for (const [currency, rate] of Object.entries(base)) {
                if (currency === baseCurrency) {
                    newRates[currency] = 1;
                } else {
                    newRates[currency] = generateDemoRate(rate);
                }
            }
            
            return newRates;
        }

        async function fetchExchangeRates(baseCurrency) {
            // DEMO MODE: Use demo rates (no API calls)
            if (demoMode) {
                return getDemoRates(baseCurrency);
            }
            
            // REAL MODE: Check cache first
            const cacheKey = baseCurrency;
            const now = Date.now();
            
            if (rateCache[cacheKey] && (now - rateCache[cacheKey].timestamp) < cacheDuration) {
                return rateCache[cacheKey].rates;
            }
            
            try {
                // Call Netlify function (real API)
                const response = await fetch(`/.netlify/functions/get-rates?base=${baseCurrency}`);
                const data = await response.json();
                
                if (data.fallback || !data.conversion_rates) {
                    throw new Error('API returned fallback');
                }
                
                // Cache the response
                rateCache[cacheKey] = {
                    rates: data.conversion_rates,
                    timestamp: now
                };
                
                return data.conversion_rates;
                
            } catch (error) {
                // If API fails, use demo rates
                return getDemoRates(baseCurrency);
            }
        }

        async function convertCurrency(fromCurrency, amount) {
            const results = [];
            
            try {
                const newRates = await fetchExchangeRates(fromCurrency);
                const targetCurrencies = currencies.filter(currency => currency !== fromCurrency);
                
                targetCurrencies.forEach(targetCurrency => {
                    const currentRate = newRates[targetCurrency];
                    const convertedAmount = amount * currentRate;
                    
                    let percentageChange = 0;
                    if (currentRates[fromCurrency] && currentRates[fromCurrency][targetCurrency]) {
                        const previousRate = currentRates[fromCurrency][targetCurrency];
                        percentageChange = calculatePercentageChange(currentRate, previousRate);
                    }
                    
                    results.push({
                        code: targetCurrency,
                        name: currencyData[targetCurrency].name,
                        flag: currencyData[targetCurrency].flag,
                        amount: convertedAmount,
                        rate: currentRate,
                        percentageChange: percentageChange
                    });
                });
                
                currentRates[fromCurrency] = newRates;
                
            } catch (error) {
                // Fallback calculation
                const targetCurrencies = currencies.filter(currency => currency !== fromCurrency);
                targetCurrencies.forEach(targetCurrency => {
                    const hardcodedRates = {
                        SGD: { MYR: 3.1807, IDR: 11286.57, SAR: 2.79, USD: 0.74 },
                        MYR: { SGD: 0.3145, IDR: 3560.25, SAR: 0.88, USD: 0.234 },
                        IDR: { SGD: 0.0000886, MYR: 0.000281, SAR: 0.000247, USD: 0.000066 },
                        SAR: { SGD: 0.358, MYR: 1.137, IDR: 4052.12, USD: 0.267 },
                        USD: { SGD: 1.351, MYR: 4.285, IDR: 15280.50, SAR: 3.75 }
                    };
                    
                    const rate = hardcodedRates[fromCurrency][targetCurrency] || 1;
                    const convertedAmount = amount * rate;
                    
                    results.push({
                        code: targetCurrency,
                        name: currencyData[targetCurrency].name,
                        flag: currencyData[targetCurrency].flag,
                        amount: convertedAmount,
                        rate: rate,
                        percentageChange: 0
                    });
                });
            }
            
            return results;
        }

        function updateDisplay(results) {
            const resultsContainer = document.getElementById('results');
            
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="loading">Loading exchange rates...</div>';
                return;
            }
            
            resultsContainer.innerHTML = '';
            
            results.forEach(result => {
                const card = document.createElement('div');
                card.className = 'currency-card';
                
                const { arrow, arrowClass, changeClass } = getArrowAndClass(result.percentageChange);
                const percentageText = formatPercentage(result.percentageChange);
                
                card.innerHTML = `
                    <div class="currency-info">
                        <div class="currency-flag">${result.flag}</div>
                        <div class="currency-details">
                            <h3>${result.code}</h3>
                            <p>${result.name}</p>
                        </div>
                    </div>
                    <div class="conversion-result">
                        <div class="conversion-amount">${formatCurrency(result.amount, result.code)}</div>
                        <div class="percentage-change ${changeClass}">
                            <span class="arrow ${arrowClass}">${arrow}</span>
                            ${percentageText}
                        </div>
                    </div>
                `;
                
                resultsContainer.appendChild(card);
            });
            
            updateTimestamp();
        }

        function updateTimestamp() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour12: true, 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('updateTime').textContent = timeString;
        }

        setInterval(updateTimestamp, 1000);

        async function updateAndDisplay() {
            const fromCurrency = document.getElementById('fromCurrency').value;
            const amount = parseFloat(document.getElementById('amount').value) || 100;
            
            try {
                const results = await convertCurrency(fromCurrency, amount);
                updateDisplay(results);
            } catch (error) {
                document.getElementById('results').innerHTML = 
                    '<div style="text-align: center; padding: 20px; color: #dc2626;">Error loading exchange rates. Using demo data.</div>';
            }
        }

        async function refreshRates() {
            const refreshBtn = document.getElementById('refreshBtn');
            const originalText = refreshBtn.textContent;
            
            refreshBtn.textContent = 'Loading...';
            refreshBtn.disabled = true;
            
            try {
                await updateAndDisplay();
                
                refreshBtn.textContent = 'âœ“ Rates Updated!';
                refreshBtn.style.background = '#10b981';
                
                setTimeout(() => {
                    refreshBtn.textContent = originalText;
                    refreshBtn.style.background = '';
                    refreshBtn.disabled = false;
                }, 2000);
                
            } catch (error) {
                refreshBtn.textContent = 'âœ— Error';
                refreshBtn.style.background = '#dc2626';
                
                setTimeout(() => {
                    refreshBtn.textContent = originalText;
                    refreshBtn.style.background = '';
                    refreshBtn.disabled = false;
                }, 2000);
            }
        }

        function resetToDefault() {
            document.getElementById('fromCurrency').value = 'SGD';
            document.getElementById('amount').value = '100';
            updateAndDisplay();
        }

        function toggleMode() {
            demoMode = !demoMode;
            const modeBtn = document.getElementById('modeBtn');
            const modeIndicator = document.getElementById('modeIndicator');
            
            if (demoMode) {
                modeBtn.textContent = 'ðŸ”„ Switch to Real Rates';
                modeBtn.className = 'btn btn-warning';
                modeIndicator.textContent = 'ðŸ”µ DEMO MODE - Using simulated rates (No API calls)';
                modeIndicator.style.color = '#f59e0b';
            } else {
                modeBtn.textContent = 'ðŸ”„ Switch to Demo Mode';
                modeBtn.className = 'btn btn-success';
                modeIndicator.textContent = 'âœ… REAL MODE - Using live API rates';
                modeIndicator.style.color = '#10b981';
            }
            
            // Clear cache and refresh
            rateCache = {};
            currentRates = {};
            refreshRates();
        }

        // Initialize event listeners
        document.getElementById('fromCurrency').addEventListener('change', updateAndDisplay);
        document.getElementById('amount').addEventListener('input', updateAndDisplay);
        document.getElementById('refreshBtn').addEventListener('click', refreshRates);
        document.getElementById('resetBtn').addEventListener('click', resetToDefault);
        document.getElementById('modeBtn').addEventListener('click', toggleMode);

        // Initial display
        updateAndDisplay();

        // Auto-refresh every 30 seconds
        setInterval(refreshRates, 30000);
    </script>
</body>
</html>
